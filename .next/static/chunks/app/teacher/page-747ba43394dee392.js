(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[941],{495:function(e,t,a){Promise.resolve().then(a.bind(a,6204))},6204:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return b}});var r=a(7437),s=a(2265),n=a(7138),i=a(9630),l=a(7374),d=a(9506),c=a(9842),o=a(5735),m=a(5236),u=a(9783),x=a(2107),f=a(8726);function p(e){let{onStudentRegistered:t}=e,{user:a,roleInfo:n}=(0,i.a)(),l=(null==n?void 0:n.role)==="admin",[p,h]=(0,s.useState)(!1),[g,b]=(0,s.useState)(null),[N,y]=(0,s.useState)(null),[j,v]=(0,s.useState)(""),[w,E]=(0,s.useState)({name:"",age:"",class:"",parentPhone:"",parentEmail:"",parentPassword:"",parentConfirm:"",studentEmail:""}),P=e=>{let t={};return Object.entries(e).forEach(e=>{let[a,r]=e;void 0!==r&&(t[a]=r)}),t},A=e=>e.trim().toUpperCase().replace(/\s+/g,""),_=async e=>{let t=A(e)||"CLASS",a=new Date().getFullYear();for(let e=0;e<18;e++){let e=Math.floor(1e3+9e3*Math.random()),r="".concat(t,"-").concat(a,"-").concat(e),s=(0,c.JU)((0,c.hJ)(d.db,"students"),r);if(!(await (0,c.QT)(s)).exists())return r}return"".concat(t,"-").concat(a,"-").concat(Date.now().toString().slice(-4))},S=async e=>{let t="".concat(window.location.origin,"/student-id/").concat(e);return u.toDataURL(t,{width:220,margin:2,color:{dark:"#000000",light:"#ffffff"}})},C=async e=>{let t=await (0,x.Z)(e,{maxSizeMB:.4,maxWidthOrHeight:700,useWebWorker:!0}),a=await new Promise((e,a)=>{let r=new FileReader;r.onload=()=>e(r.result.replace(/^data:[^;]+;base64,/,"")),r.onerror=a,r.readAsDataURL(t)}),r=await fetch("/api/imagekit/upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file:a,fileName:"student_".concat(Date.now(),".jpg")})});if(!r.ok)throw Error("Image upload failed");let s=await r.json();if(!(null==s?void 0:s.url))throw Error("No image URL returned");return s.url},I=()=>w.name.trim()?!w.age.trim()||isNaN(Number(w.age))?(f.ZP.error("Valid age required"),!1):w.class.trim()?w.parentEmail.trim()?/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(w.parentEmail)?w.parentPassword.length<6?(f.ZP.error("Parent password min 6 chars"),!1):w.parentPassword===w.parentConfirm||(f.ZP.error("Parent passwords do not match"),!1):(f.ZP.error("Invalid parent email"),!1):(f.ZP.error("Parent email required"),!1):(f.ZP.error("Class is required"),!1):(f.ZP.error("Name is required"),!1),D=async e=>{if(e.preventDefault(),a&&I()){h(!0);try{let e;let s=await _(w.class);if(N)try{e=await C(N)}catch(e){f.ZP.error("Photo upload failed")}let n=w.name.trim(),i=n.split(/\s+/),u=i[0],x=i.length>1?i.slice(1).join(" "):void 0,p={name:n,firstName:u,lastName:x,class:w.class.trim(),classLevel:w.class.trim(),age:Number(w.age),rollNumber:s,parentPhone:w.parentPhone||void 0,parentEmail:w.parentEmail||void 0,photoUrl:e,registeredBy:l?"admin":"teacher",registeredByUid:a.uid,feeStatus:{term1:!1,term2:!1,term3:!1},createdAt:new Date,updatedAt:new Date};if(l){let e=await S(s);p.qrCode=e,p.qrGeneratedAt=new Date,p.qrGeneratedBy=a.uid,p.qrHistory=[{generatedAt:new Date,generatedBy:a.uid}]}let h=P(p),g=(0,c.JU)((0,c.hJ)(d.db,"students"),s);await (0,c.pl)(g,h);try{let e="parent-provision",t=(0,m.C6)().find(t=>t.name===e)||(0,m.ZF)(d.I.app.options,e),a=(0,o.v0)(t),r=await (0,o.Xb)(a,w.parentEmail.trim(),w.parentPassword);await (0,c.pl)((0,c.JU)((0,c.hJ)(d.db,"users"),r.user.uid),{role:"parent",studentId:s,email:w.parentEmail.trim(),createdAt:new Date},{merge:!0})}catch(e){f.ZP.error("Parent auth create failed: "+((null==e?void 0:e.message)||"error"))}let j={...h,id:g.id};b(g.id),f.ZP.success("Student registered".concat(l?" (QR ready)":"",". ID generated.")),f.ZP.custom((0,r.jsxs)("div",{className:"bg-white text-midnight_text text-xs px-3 py-2 rounded shadow",children:[(0,r.jsx)("div",{children:"Student ID:"}),(0,r.jsx)("div",{className:"font-mono text-sm font-semibold",children:g.id})]}),{duration:8e3}),E({name:"",age:"",class:"",parentPhone:"",parentEmail:"",parentPassword:"",parentConfirm:"",studentEmail:""}),y(null),v(""),null==t||t(j)}catch(e){console.error("Registration error",e),f.ZP.error("Registration failed: "+((null==e?void 0:e.message)||"unknown"))}finally{h(!1)}}};return(0,r.jsxs)("div",{className:"card p-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center",children:(0,r.jsx)("i",{className:"fas fa-user-plus text-primary"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-midnight_text",children:"Register New Student"}),(0,r.jsx)("p",{className:"text-sm text-grey",children:l?"Admin registration (QR + optional login)":"Teacher registration (no QR, no student email field)"})]})]}),(0,r.jsxs)("form",{onSubmit:D,className:"space-y-6",children:[g&&(0,r.jsxs)("div",{className:"p-3 rounded border border-green-500/40 bg-green-500/10 text-xs flex items-center justify-between gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Last Student ID:"})," ",(0,r.jsx)("span",{className:"font-mono",children:g}),(0,r.jsx)("div",{className:"text-[10px] text-grey mt-1",children:"Used as initial password if login was provisioned."})]}),(0,r.jsx)("button",{type:"button",onClick:()=>{navigator.clipboard.writeText(g),f.ZP.success("Copied")},className:"btn outline text-xs",children:"Copy"})]}),(0,r.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-midnight_text mb-2",children:"Student Name *"}),(0,r.jsx)("input",{value:w.name,onChange:e=>E(t=>({...t,name:e.target.value})),placeholder:"Full Name",className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary focus:border-primary"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-midnight_text mb-2",children:"Age *"}),(0,r.jsx)("input",{value:w.age,onChange:e=>E(t=>({...t,age:e.target.value})),placeholder:"e.g. 12",className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary focus:border-primary"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-midnight_text mb-2",children:"Class *"}),(0,r.jsx)("input",{value:w.class,onChange:e=>E(t=>({...t,class:e.target.value})),placeholder:"JSS1",className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary focus:border-primary"})]}),l&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-midnight_text mb-2",children:"Student Email (optional)"}),(0,r.jsx)("input",{value:w.studentEmail||"",onChange:e=>E(t=>({...t,studentEmail:e.target.value})),placeholder:"student@example.com",className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary focus:border-primary"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-midnight_text mb-2",children:"Student Photo"}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[j?(0,r.jsx)("img",{src:j,alt:"Preview",className:"w-20 h-20 rounded-full object-cover border-2 border-gray-200"}):(0,r.jsx)("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center",children:(0,r.jsx)("i",{className:"fas fa-camera text-gray-400 text-xl"})}),(0,r.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!a)return;y(a);let r=new FileReader;r.onload=()=>v(r.result),r.readAsDataURL(a)},className:"flex-1"})]})]}),(0,r.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-midnight_text mb-2",children:"Parent Phone"}),(0,r.jsx)("input",{value:w.parentPhone,onChange:e=>E(t=>({...t,parentPhone:e.target.value})),placeholder:"+234...",className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary focus:border-primary"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-midnight_text mb-2",children:"Parent Email"}),(0,r.jsx)("input",{type:"email",value:w.parentEmail,onChange:e=>E(t=>({...t,parentEmail:e.target.value})),placeholder:"parent@example.com",className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary focus:border-primary"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-midnight_text mb-2",children:"Parent Password"}),(0,r.jsx)("input",{type:"password",value:w.parentPassword,onChange:e=>E(t=>({...t,parentPassword:e.target.value})),placeholder:"Parent password",className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary focus:border-primary"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-midnight_text mb-2",children:"Confirm Password"}),(0,r.jsx)("input",{type:"password",value:w.parentConfirm,onChange:e=>E(t=>({...t,parentConfirm:e.target.value})),placeholder:"Confirm password",className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary focus:border-primary"})]})]}),l&&(0,r.jsxs)("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-4 flex items-start gap-3",children:[(0,r.jsx)("i",{className:"fas fa-qrcode text-primary mt-1"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-medium text-primary",children:"QR Code Auto Generation"}),(0,r.jsx)("p",{className:"text-xs text-grey mt-1",children:"Admins automatically create a QR code used for the student's digital ID card."})]})]}),(0,r.jsx)("button",{type:"submit",disabled:p,className:"w-full btn btn-primary btn-lg justify-center",children:p?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("i",{className:"fas fa-spinner fa-spin"})," Processing..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("i",{className:"fas fa-user-plus"})," ",l?"Register Student (QR)":"Register Student"]})})]})]})}function h(e){let{student:t,onAttendanceClick:a,onUpdateClick:s,showActions:n=!0}=e;return(0,r.jsx)("div",{className:"card p-6 hover:shadow-lg transition-all duration-200",children:(0,r.jsxs)("div",{className:"flex gap-6",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:t.photoUrl?(0,r.jsx)("img",{src:t.photoUrl,alt:t.name,className:"w-24 h-24 rounded-full object-cover border-4 border-primary/20"}):(0,r.jsx)("div",{className:"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center border-4 border-gray-200",children:(0,r.jsx)("i",{className:"fas fa-user text-gray-400 text-2xl"})})}),(0,r.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-xl font-semibold text-midnight_text",children:t.name}),(0,r.jsxs)("div",{className:"flex items-center gap-4 text-sm text-grey mt-1",children:[(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)("i",{className:"fas fa-id-badge text-primary"}),"Roll: ",t.rollNumber]}),(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)("i",{className:"fas fa-graduation-cap text-primary"}),t.class]}),(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)("i",{className:"fas fa-birthday-cake text-primary"}),t.age," years"]})]})]}),(t.parentPhone||t.parentEmail)&&(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-midnight_text",children:"Parent Contact:"}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-3 text-sm text-grey",children:[t.parentPhone&&(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)("i",{className:"fas fa-phone text-success"}),t.parentPhone]}),t.parentEmail&&(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)("i",{className:"fas fa-envelope text-success"}),t.parentEmail]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4 text-xs text-grey pt-2 border-t border-gray-100",children:[(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)("i",{className:"fas fa-user-shield"}),"Registered by ",t.registeredBy]}),(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)("i",{className:"fas fa-calendar"}),t.createdAt.toLocaleDateString()]})]}),n&&(0,r.jsxs)("div",{className:"flex gap-3 pt-3",children:[(0,r.jsxs)("button",{onClick:a,className:"btn btn-sm bg-success text-white hover:bg-success/90",children:[(0,r.jsx)("i",{className:"fas fa-check-circle"}),"Mark Attendance"]}),(0,r.jsxs)("button",{onClick:s,className:"btn btn-sm btn-outline",children:[(0,r.jsx)("i",{className:"fas fa-edit"}),"Update Info"]})]})]}),(0,r.jsx)("div",{className:"flex-shrink-0 text-center",children:t.qrCode?(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("img",{src:t.qrCode,alt:"Student QR Code",className:"w-20 h-20 border border-gray-200 rounded-lg"}),(0,r.jsx)("p",{className:"text-xs text-grey",children:"Digital ID"}),(0,r.jsxs)("button",{className:"text-xs text-primary hover:underline",children:[(0,r.jsx)("i",{className:"fas fa-external-link-alt"}),"View ID Card"]})]}):(0,r.jsxs)("div",{className:"w-20 h-20 bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center",children:[(0,r.jsx)("i",{className:"fas fa-qrcode text-gray-300 text-lg"}),(0,r.jsx)("p",{className:"text-xs text-grey mt-1",children:"No QR Code"}),(0,r.jsx)("p",{className:"text-xs text-grey",children:"(Teacher reg.)"})]})})]})})}var g=a(4819);function b(){return(0,r.jsx)(g.Z,{allowed:["teacher","admin"],children:(0,r.jsx)(N,{})})}function N(){let{user:e}=(0,i.a)(),[t,a]=(0,s.useState)("overview"),[d,c]=(0,s.useState)([]),[o,m]=(0,s.useState)(""),[u,x]=(0,s.useState)(""),[g,b]=(0,s.useState)(!1);(0,s.useEffect)(()=>{"students"===t&&N()},[t,u,o]),(0,s.useEffect)(()=>{0===d.length&&N(!0)},[]);let N=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];b(t=>!e||t);try{let e=[];e=(e="students"===t?o.trim()?await (0,l.b0)(o.trim()):u?await (0,l._8)(u):await (0,l.b0)(""):await (0,l.b0)("")).map(e=>({...e,name:e.name||[e.firstName,e.lastName].filter(Boolean).join(" ").trim()||e.rollNumber})),c(e)}catch(t){console.error("Error fetching students:",t),e||f.ZP.error("Failed to load students")}finally{b(!1)}},y=async t=>{try{let a=new Date().toISOString().split("T")[0];await (0,l.YF)(t.id,a,"present",(null==e?void 0:e.uid)||""),f.ZP.success("Marked ".concat(t.name," as present"))}catch(e){console.error("Error marking attendance:",e),f.ZP.error("Failed to mark attendance")}},j=e=>{console.log("Update student:",e)};return(0,r.jsx)("div",{className:"min-h-screen bg-slateGray py-8",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-midnight_text",children:"Teacher Dashboard"}),(0,r.jsxs)("p",{className:"text-grey mt-2",children:["Welcome back, ",null==e?void 0:e.email]})]}),(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 mb-8",children:(0,r.jsx)("nav",{className:"flex space-x-8 px-6",children:[{id:"overview",label:"Overview",icon:"fas fa-tachometer-alt"},{id:"register",label:"Register Student",icon:"fas fa-user-plus"},{id:"students",label:"Students",icon:"fas fa-users"},{id:"attendance",label:"Attendance",icon:"fas fa-check-circle"}].map(e=>(0,r.jsxs)("button",{onClick:()=>a(e.id),className:"flex items-center gap-2 py-4 px-2 border-b-2 font-medium text-sm transition-colors ".concat(t===e.id?"border-primary text-primary":"border-transparent text-grey hover:text-midnight_text hover:border-gray-300"),children:[(0,r.jsx)("i",{className:e.icon}),e.label]},e.id))})}),"overview"===t&&(0,r.jsxs)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:[(0,r.jsx)("div",{className:"card p-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-grey",children:"Total Students"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-midnight_text",children:d.length})]}),(0,r.jsx)("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center",children:(0,r.jsx)("i",{className:"fas fa-users text-primary text-xl"})})]})}),(0,r.jsx)("div",{className:"card p-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-grey",children:"Present Today"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-midnight_text",children:"--"})]}),(0,r.jsx)("div",{className:"w-12 h-12 bg-success/10 rounded-full flex items-center justify-center",children:(0,r.jsx)("i",{className:"fas fa-check-circle text-success text-xl"})})]})}),(0,r.jsx)("div",{className:"card p-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-grey",children:"QR Students"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-midnight_text",children:d.filter(e=>e.qrCode).length})]}),(0,r.jsx)("div",{className:"w-12 h-12 bg-secondary/10 rounded-full flex items-center justify-center",children:(0,r.jsx)("i",{className:"fas fa-qrcode text-secondary text-xl"})})]})})]}),"register"===t&&(0,r.jsx)(p,{onStudentRegistered:e=>{c(t=>[e,...t]),a("students")}}),"students"===t&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"card p-4",children:(0,r.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,r.jsx)("div",{className:"flex-1 min-w-64",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:"text",placeholder:"Search students by name or roll number...",value:o,onChange:e=>m(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary"}),(0,r.jsx)("i",{className:"fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-grey"})]})}),(0,r.jsxs)("select",{value:u,onChange:e=>x(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary",children:[(0,r.jsx)("option",{value:"",children:"All Classes"}),["Grade 1","Grade 2","Grade 3","Grade 4","Grade 5","Form 1","Form 2","Form 3"].map(e=>(0,r.jsx)("option",{value:e,children:e},e))]}),(0,r.jsx)("button",{onClick:()=>N(),disabled:g,className:"btn btn-primary",children:g?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("i",{className:"fas fa-spinner fa-spin"}),"Loading..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("i",{className:"fas fa-refresh"}),"Refresh"]})})]})}),(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsx)(n.default,{href:"/teacher/students",className:"text-sm text-primary hover:underline font-medium",children:"Go to full management view â†’"})}),g?(0,r.jsxs)("div",{className:"card p-8 text-center",children:[(0,r.jsx)("i",{className:"fas fa-spinner fa-spin text-primary text-2xl mb-4"}),(0,r.jsx)("p",{className:"text-grey",children:"Loading students..."})]}):0===d.length?(0,r.jsxs)("div",{className:"card p-8 text-center",children:[(0,r.jsx)("i",{className:"fas fa-users text-grey text-3xl mb-4"}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-midnight_text mb-2",children:"No Students Found"}),(0,r.jsx)("p",{className:"text-grey mb-4",children:o||u?"No students match your current filters.":"Get started by registering your first student."}),(0,r.jsxs)("button",{onClick:()=>a("register"),className:"btn btn-primary",children:[(0,r.jsx)("i",{className:"fas fa-user-plus"}),"Register Student"]})]}):(0,r.jsx)("div",{className:"space-y-4",children:d.map(e=>(0,r.jsx)(h,{student:e,onAttendanceClick:()=>y(e),onUpdateClick:()=>j(e),showActions:!0},e.id))})]}),"attendance"===t&&(0,r.jsxs)("div",{className:"card p-6 space-y-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-midnight_text",children:"Attendance Management"}),(0,r.jsx)("p",{className:"text-grey text-sm",children:"Use the dedicated attendance page for a monthly matrix and CSV export."}),(0,r.jsxs)(n.default,{href:"/teacher/attendance",className:"btn btn-primary w-fit text-sm",children:[(0,r.jsx)("i",{className:"fas fa-table"})," Open Attendance Page"]})]})]})})}},4819:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});var r=a(7437),s=a(2265),n=a(6463),i=a(9630);function l(e){let{allowed:t,children:a}=e,{loading:l,roleInfo:d,isOverrideAdmin:c}=(0,i.a)(),o=(0,n.useRouter)(),m=(null==d?void 0:d.role)||(c?"admin":null);return((0,s.useEffect)(()=>{l||m&&t.includes(m)||o.replace("/login")},[l,m,t,o]),l)?(0,r.jsx)("p",{className:"text-center py-10 text-white/80",children:"Loading..."}):m&&t.includes(m)?(0,r.jsx)(r.Fragment,{children:a}):null}},9630:function(e,t,a){"use strict";a.d(t,{AuthProvider:function(){return c},a:function(){return o}});var r=a(7437),s=a(2265),n=a(5735),i=a(9842),l=a(9506);let d=(0,s.createContext)({user:null,loading:!0,roleInfo:null,logout:async()=>{},isOverrideAdmin:!1,enableAdminOverride:()=>{}}),c=e=>{let{children:t}=e,[a,c]=(0,s.useState)(null),[o,m]=(0,s.useState)(!0),[u,x]=(0,s.useState)(null),[f,p]=(0,s.useState)(!!localStorage.getItem("overrideAdmin"));async function h(){localStorage.removeItem("overrideAdmin"),l.I.currentUser&&await (0,n.w7)(l.I)}return(0,s.useEffect)(()=>{let e=(0,n.Aj)(l.I,async e=>{c(e);let t=localStorage.getItem("pendingRole");if(e){let a=(0,i.JU)(l.db,"users",e.uid),r=await (0,i.QT)(a);if(r.exists()){let e=r.data();x({role:e.role,studentId:e.studentId,classLevels:e.classLevels})}else t?x({role:t}):x(null)}else x(null);m(!1),t&&localStorage.removeItem("pendingRole")});return()=>e()},[]),(0,r.jsx)(d.Provider,{value:{user:a,loading:o,roleInfo:u||(f?{role:"admin"}:null),logout:h,isOverrideAdmin:f,enableAdminOverride:function(){localStorage.setItem("overrideAdmin","true"),p(!0),x({role:"admin"})}},children:t})},o=()=>(0,s.useContext)(d)},7374:function(e,t,a){"use strict";a.d(t,{BM:function(){return y},Gc:function(){return m},KD:function(){return d},O7:function(){return v},QN:function(){return g},Wv:function(){return p},YF:function(){return u},_8:function(){return c},_l:function(){return N},b0:function(){return o},iM:function(){return j},l6:function(){return h},tS:function(){return f},y7:function(){return b}});var r=a(9506),s=a(9842),n=a(2107),i=a(9783),l=a(357);async function d(e){try{var t,a;let n=await (0,s.QT)((0,s.JU)(r.db,"students",e));if(!n.exists())return null;let i=n.data(),l=i.name||[i.firstName,i.lastName].filter(Boolean).join(" ").trim();return{id:n.id,name:l,firstName:i.firstName,lastName:i.lastName,class:i.class||i.classLevel||"",classLevel:i.classLevel,email:i.email,age:i.age||0,rollNumber:i.rollNumber||i.id||"",parentPhone:i.parentPhone,parentEmail:i.parentEmail,photoUrl:i.photoUrl,qrCode:i.qrCode,registeredBy:i.registeredBy||"admin",registeredByUid:i.registeredByUid||i.createdBy||"",feeStatus:i.feeStatus||{term1:!1,term2:!1,term3:!1},createdAt:(null===(t=i.createdAt)||void 0===t?void 0:t.toDate)?i.createdAt.toDate():i.createdAt?new Date(i.createdAt):new Date,updatedAt:(null===(a=i.updatedAt)||void 0===a?void 0:a.toDate)?i.updatedAt.toDate():i.updatedAt?new Date(i.updatedAt):new Date}}catch(e){return console.error("Error fetching student:",e),null}}async function c(e){try{let t=(0,s.IO)((0,s.hJ)(r.db,"students"),(0,s.ar)("class","==",e),(0,s.Xo)("name"));return(await (0,s.PL)(t)).docs.map(e=>{var t,a;return{...e.data(),id:e.id,createdAt:(null===(t=e.data().createdAt)||void 0===t?void 0:t.toDate())||new Date,updatedAt:(null===(a=e.data().updatedAt)||void 0===a?void 0:a.toDate())||new Date}})}catch(e){return console.error("Error fetching students by class:",e),[]}}async function o(e){try{let t=(await (0,s.PL)((0,s.hJ)(r.db,"students"))).docs.map(e=>{var t,a;let r=e.data(),s=r.name||[r.firstName,r.lastName].filter(Boolean).join(" ").trim();return{id:e.id,name:s,firstName:r.firstName,lastName:r.lastName,class:r.class||r.classLevel||"",classLevel:r.classLevel,email:r.email,age:r.age||0,rollNumber:r.rollNumber||e.id,parentPhone:r.parentPhone,parentEmail:r.parentEmail,photoUrl:r.photoUrl,qrCode:r.qrCode,registeredBy:r.registeredBy||"admin",registeredByUid:r.registeredByUid||r.createdBy||"",feeStatus:r.feeStatus||{term1:!1,term2:!1,term3:!1},createdAt:(null===(t=r.createdAt)||void 0===t?void 0:t.toDate)?r.createdAt.toDate():r.createdAt?new Date(r.createdAt):new Date,updatedAt:(null===(a=r.updatedAt)||void 0===a?void 0:a.toDate)?r.updatedAt.toDate():r.updatedAt?new Date(r.updatedAt):new Date}}),a=e.toLowerCase();return t.filter(e=>e.name.toLowerCase().includes(a)||e.rollNumber.toLowerCase().includes(a))}catch(e){return console.error("Error searching students:",e),[]}}async function m(e,t){try{let a={...t,updatedAt:new Date};if(t.name&&!t.firstName&&!t.lastName){let e=t.name.split(" ");e.length>1&&(a.firstName=e.slice(0,-1).join(" "),a.lastName=e.slice(-1).join(" "))}await (0,s.r7)((0,s.JU)(r.db,"students",e),a)}catch(e){throw console.error("Error updating student:",e),e}}async function u(e,t,a,n){try{let i=(0,s.JU)((0,s.hJ)(r.db,"attendance")),l={id:i.id,studentId:e,date:t,status:a,markedBy:n,markedAt:new Date};await (0,s.pl)(i,l)}catch(e){throw console.error("Error marking attendance:",e),e}}async function x(e){let t=new Date().getFullYear();return"".concat(e.replace(/\s+/g,"").toUpperCase(),"-").concat(t,"-").concat(Math.floor(1e3+9e3*Math.random()))}async function f(e){let t;let a=await x(e.classLevel);if(e.photoFile){var d;let r=e.photoFile;if(!["image/jpeg","image/jpg","image/png"].includes(r.type))throw Error("VALIDATION_UNSUPPORTED_TYPE");if(r.size>5242880)throw Error("VALIDATION_FILE_TOO_LARGE");let s=await (0,n.Z)(r,{maxSizeMB:.25,maxWidthOrHeight:600}),i=s instanceof Blob?s:new Blob([s]),c=new FormData;c.append("image",i,"".concat(a,".jpg"));let o=l.env.NEXT_PUBLIC_IMGBB_KEY||"eb795bdf868353332baf6495a1a83fa0",m=await fetch("https://api.imgbb.com/1/upload?key=".concat(o),{method:"POST",body:c}),u=await m.json();if(!m.ok||!(null==u?void 0:u.success))throw Error("IMGBB_UPLOAD_FAILED");if(!(t=null===(d=u.data)||void 0===d?void 0:d.url))throw Error("IMGBB_NO_URL_RETURNED")}let{photoFile:c,...o}=e,m={...o,id:a,photoUrl:t,feeStatus:{term1:!1,term2:!1,term3:!1},createdAt:Date.now()};await (0,s.pl)((0,s.JU)(r.db,"students",a),m);let u=window.location.origin;return{student:m,qrDataUrl:await i.toDataURL("".concat(u,"/id/").concat(a)),password:a}}async function p(e){let t=await (0,s.QT)((0,s.JU)(r.db,"students",e));return t.exists()?t.data():null}async function h(e){let t=(0,s.hJ)(r.db,"students"),a=await (0,s.PL)(t),n=e.toLowerCase();return a.docs.map(e=>({...e.data(),id:e.data().id||e.id})).filter(e=>(e.firstName||"").toLowerCase().includes(n)||(e.lastName||"").toLowerCase().includes(n)||(e.id||"").toLowerCase().includes(n))}async function g(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1?arguments[1]:void 0,a=(0,s.hJ)(r.db,"students"),n=(0,s.IO)(a,(0,s.Xo)("createdAt","desc"),(0,s.b9)(e));t&&(n=(0,s.IO)(a,(0,s.Xo)("createdAt","desc"),(0,s.TQ)(t),(0,s.b9)(e)));let i=await (0,s.PL)(n);return{students:i.docs.map(e=>({...e.data(),id:e.data().id||e.id})),cursor:i.docs.length===e?i.docs[i.docs.length-1]:null}}async function b(e,t,a){await (0,s.r7)((0,s.JU)(r.db,"students",e),{["feeStatus.".concat(t)]:a})}async function N(e,t,a){if(isNaN(new Date(t).getTime()))throw Error("Invalid date");let n=t.slice(0,7),i=(0,s.JU)(r.db,"students",e,"attendance",n),l=await (0,s.QT)(i),d=l.exists()&&l.data().days||{};d[t]=a,await (0,s.pl)(i,{days:d},{merge:!0})}async function y(e,t,a){let n="".concat(t,"-").concat(String(a).padStart(2,"0")),i=(0,s.JU)(r.db,"students",e,"attendance",n),l=await (0,s.QT)(i);return l.exists()&&l.data().days||{}}async function j(e,t,a){await (0,s.pl)((0,s.JU)(r.db,"students",e,"results",t),{subjects:a,updatedAt:Date.now()})}async function v(e,t){let a=await (0,s.QT)((0,s.JU)(r.db,"students",e,"results",t));return a.exists()?a.data():null}},9506:function(e,t,a){"use strict";let r;a.d(t,{I:function(){return m},db:function(){return f}});var s=a(5236),n=a(5735),i=a(9842),l=a(9854),d=a(357);let c={apiKey:d.env.NEXT_PUBLIC_FIREBASE_API_KEY||"AIzaSyD239JqpspNL_KN7-buMq2PTWUM5P0D5YA",authDomain:d.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN||"milliniem-86b63.firebaseapp.com",projectId:d.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID||"milliniem-86b63",storageBucket:d.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET||"milliniem-86b63.appspot.com",messagingSenderId:d.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID||"455693438371",appId:d.env.NEXT_PUBLIC_FIREBASE_APP_ID||"1:455693438371:web:0a64c5c007cb906e241e16",measurementId:d.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID||"G-KHHJRMKW9V"},o=(0,s.C6)().length?(0,s.C6)()[0]:(0,s.ZF)(c),m=(0,n.v0)(o),u="true"===d.env.NEXT_PUBLIC_FIRESTORE_FORCE_LONG_POLLING,x="true"===d.env.NEXT_PUBLIC_FIRESTORE_AUTODETECT_STREAMING;try{u||x?(r=(0,i.LV)(o,{experimentalForceLongPolling:u,experimentalAutoDetectLongPolling:x}),console.log("[firebase] Firestore initialized with options",{forceLongPolling:u,autoDetect:x})):r=(0,i.ad)(o)}catch(e){console.error("[firebase] Firestore init error, falling back to default",e),r=(0,i.ad)(o)}let f=r;(0,l.cF)(o)}},function(e){e.O(0,[358,139,712,873,138,726,971,23,744],function(){return e(e.s=495)}),_N_E=e.O()}]);