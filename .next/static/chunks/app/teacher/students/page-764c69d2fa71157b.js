(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[810],{4105:function(e,t,a){Promise.resolve().then(a.bind(a,9545))},9545:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return o}});var r=a(7437),n=a(2265),i=a(4819),s=a(7138),l=a(7374);function o(){return(0,r.jsx)(i.Z,{allowed:["teacher","admin"],children:(0,r.jsx)(d,{})})}function d(){let[e,t]=(0,n.useState)([]),[a,i]=(0,n.useState)(""),[o,d]=(0,n.useState)(!1);async function c(){d(!0),t(await (0,l.b0)(a.trim())),d(!1)}return(0,n.useEffect)(()=>{c()},[]),(0,n.useEffect)(()=>{let e=setTimeout(()=>c(),400);return()=>clearTimeout(e)},[a]),(0,r.jsx)("div",{className:"min-h-screen bg-slateGray py-8",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 space-y-6",children:[(0,r.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center gap-4 justify-between",children:[(0,r.jsx)("h1",{className:"text-2xl font-semibold text-midnight_text",children:"All Students"}),(0,r.jsx)("input",{value:a,onChange:e=>i(e.target.value),placeholder:"Search name or roll",className:"w-full md:w-80 px-3 py-2 border rounded-lg border-gray-300 focus:ring-2 focus:ring-primary"})]}),o&&(0,r.jsx)("p",{className:"text-sm text-grey",children:"Loading..."}),(0,r.jsx)("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5",children:e.map(e=>(0,r.jsxs)(s.default,{href:"/teacher/students/".concat(e.id),className:"group block bg-white rounded-lg border border-gray-200 p-4 shadow hover:border-primary transition",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[e.photoUrl&&(0,r.jsx)("img",{src:e.photoUrl,className:"w-14 h-14 object-cover rounded"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-midnight_text text-sm",children:e.name}),(0,r.jsx)("p",{className:"text-xs text-grey/70",children:e.rollNumber}),(0,r.jsx)("p",{className:"text-[11px] text-grey/50",children:e.class})]})]}),(0,r.jsx)("div",{className:"mt-3 flex gap-2 opacity-0 group-hover:opacity-100 transition text-xs",children:(0,r.jsx)("span",{className:"px-2 py-1 rounded bg-primary/10 text-primary",children:"View"})})]},e.id))}),!o&&0===e.length&&(0,r.jsx)("p",{className:"text-sm text-grey",children:"No students found."})]})})}},4819:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});var r=a(7437),n=a(2265),i=a(6463),s=a(9630);function l(e){let{allowed:t,children:a}=e,{loading:l,roleInfo:o,isOverrideAdmin:d}=(0,s.a)(),c=(0,i.useRouter)(),u=(null==o?void 0:o.role)||(d?"admin":null);return((0,n.useEffect)(()=>{l||u&&t.includes(u)||c.replace("/login")},[l,u,t,c]),l)?(0,r.jsx)("p",{className:"text-center py-10 text-white/80",children:"Loading..."}):u&&t.includes(u)?(0,r.jsx)(r.Fragment,{children:a}):null}},9630:function(e,t,a){"use strict";a.d(t,{AuthProvider:function(){return d},a:function(){return c}});var r=a(7437),n=a(2265),i=a(5735),s=a(9842),l=a(9506);let o=(0,n.createContext)({user:null,loading:!0,roleInfo:null,logout:async()=>{},isOverrideAdmin:!1,enableAdminOverride:()=>{}}),d=e=>{let{children:t}=e,[a,d]=(0,n.useState)(null),[c,u]=(0,n.useState)(!0),[m,f]=(0,n.useState)(null),[p,g]=(0,n.useState)(!!localStorage.getItem("overrideAdmin"));async function h(){localStorage.removeItem("overrideAdmin"),l.I.currentUser&&await (0,i.w7)(l.I)}return(0,n.useEffect)(()=>{let e=(0,i.Aj)(l.I,async e=>{d(e);let t=localStorage.getItem("pendingRole");if(e){let a=(0,s.JU)(l.db,"users",e.uid),r=await (0,s.QT)(a);if(r.exists()){let e=r.data();f({role:e.role,studentId:e.studentId,classLevels:e.classLevels})}else t?f({role:t}):f(null)}else f(null);u(!1),t&&localStorage.removeItem("pendingRole")});return()=>e()},[]),(0,r.jsx)(o.Provider,{value:{user:a,loading:c,roleInfo:m||(p?{role:"admin"}:null),logout:h,isOverrideAdmin:p,enableAdminOverride:function(){localStorage.setItem("overrideAdmin","true"),g(!0),f({role:"admin"})}},children:t})},c=()=>(0,n.useContext)(o)},7374:function(e,t,a){"use strict";a.d(t,{BM:function(){return E},Gc:function(){return u},KD:function(){return o},O7:function(){return A},QN:function(){return v},Wv:function(){return g},YF:function(){return m},_8:function(){return d},_l:function(){return N},b0:function(){return c},iM:function(){return x},l6:function(){return h},tS:function(){return p},y7:function(){return w}});var r=a(9506),n=a(9842),i=a(2107),s=a(9783),l=a(357);async function o(e){try{var t,a;let i=await (0,n.QT)((0,n.JU)(r.db,"students",e));if(!i.exists())return null;let s=i.data(),l=s.name||[s.firstName,s.lastName].filter(Boolean).join(" ").trim();return{id:i.id,name:l,firstName:s.firstName,lastName:s.lastName,class:s.class||s.classLevel||"",classLevel:s.classLevel,email:s.email,age:s.age||0,rollNumber:s.rollNumber||s.id||"",parentPhone:s.parentPhone,parentEmail:s.parentEmail,photoUrl:s.photoUrl,qrCode:s.qrCode,registeredBy:s.registeredBy||"admin",registeredByUid:s.registeredByUid||s.createdBy||"",feeStatus:s.feeStatus||{term1:!1,term2:!1,term3:!1},createdAt:(null===(t=s.createdAt)||void 0===t?void 0:t.toDate)?s.createdAt.toDate():s.createdAt?new Date(s.createdAt):new Date,updatedAt:(null===(a=s.updatedAt)||void 0===a?void 0:a.toDate)?s.updatedAt.toDate():s.updatedAt?new Date(s.updatedAt):new Date}}catch(e){return console.error("Error fetching student:",e),null}}async function d(e){try{let t=(0,n.IO)((0,n.hJ)(r.db,"students"),(0,n.ar)("class","==",e),(0,n.Xo)("name"));return(await (0,n.PL)(t)).docs.map(e=>{var t,a;return{...e.data(),id:e.id,createdAt:(null===(t=e.data().createdAt)||void 0===t?void 0:t.toDate())||new Date,updatedAt:(null===(a=e.data().updatedAt)||void 0===a?void 0:a.toDate())||new Date}})}catch(e){return console.error("Error fetching students by class:",e),[]}}async function c(e){try{let t=(await (0,n.PL)((0,n.hJ)(r.db,"students"))).docs.map(e=>{var t,a;let r=e.data(),n=r.name||[r.firstName,r.lastName].filter(Boolean).join(" ").trim();return{id:e.id,name:n,firstName:r.firstName,lastName:r.lastName,class:r.class||r.classLevel||"",classLevel:r.classLevel,email:r.email,age:r.age||0,rollNumber:r.rollNumber||e.id,parentPhone:r.parentPhone,parentEmail:r.parentEmail,photoUrl:r.photoUrl,qrCode:r.qrCode,registeredBy:r.registeredBy||"admin",registeredByUid:r.registeredByUid||r.createdBy||"",feeStatus:r.feeStatus||{term1:!1,term2:!1,term3:!1},createdAt:(null===(t=r.createdAt)||void 0===t?void 0:t.toDate)?r.createdAt.toDate():r.createdAt?new Date(r.createdAt):new Date,updatedAt:(null===(a=r.updatedAt)||void 0===a?void 0:a.toDate)?r.updatedAt.toDate():r.updatedAt?new Date(r.updatedAt):new Date}}),a=e.toLowerCase();return t.filter(e=>e.name.toLowerCase().includes(a)||e.rollNumber.toLowerCase().includes(a))}catch(e){return console.error("Error searching students:",e),[]}}async function u(e,t){try{let a={...t,updatedAt:new Date};if(t.name&&!t.firstName&&!t.lastName){let e=t.name.split(" ");e.length>1&&(a.firstName=e.slice(0,-1).join(" "),a.lastName=e.slice(-1).join(" "))}await (0,n.r7)((0,n.JU)(r.db,"students",e),a)}catch(e){throw console.error("Error updating student:",e),e}}async function m(e,t,a,i){try{let s=(0,n.JU)((0,n.hJ)(r.db,"attendance")),l={id:s.id,studentId:e,date:t,status:a,markedBy:i,markedAt:new Date};await (0,n.pl)(s,l)}catch(e){throw console.error("Error marking attendance:",e),e}}async function f(e){let t=new Date().getFullYear();return"".concat(e.replace(/\s+/g,"").toUpperCase(),"-").concat(t,"-").concat(Math.floor(1e3+9e3*Math.random()))}async function p(e){let t;let a=await f(e.classLevel);if(e.photoFile){var o;let r=e.photoFile;if(!["image/jpeg","image/jpg","image/png"].includes(r.type))throw Error("VALIDATION_UNSUPPORTED_TYPE");if(r.size>5242880)throw Error("VALIDATION_FILE_TOO_LARGE");let n=await (0,i.Z)(r,{maxSizeMB:.25,maxWidthOrHeight:600}),s=n instanceof Blob?n:new Blob([n]),d=new FormData;d.append("image",s,"".concat(a,".jpg"));let c=l.env.NEXT_PUBLIC_IMGBB_KEY||"eb795bdf868353332baf6495a1a83fa0",u=await fetch("https://api.imgbb.com/1/upload?key=".concat(c),{method:"POST",body:d}),m=await u.json();if(!u.ok||!(null==m?void 0:m.success))throw Error("IMGBB_UPLOAD_FAILED");if(!(t=null===(o=m.data)||void 0===o?void 0:o.url))throw Error("IMGBB_NO_URL_RETURNED")}let{photoFile:d,...c}=e,u={...c,id:a,photoUrl:t,feeStatus:{term1:!1,term2:!1,term3:!1},createdAt:Date.now()};await (0,n.pl)((0,n.JU)(r.db,"students",a),u);let m=window.location.origin;return{student:u,qrDataUrl:await s.toDataURL("".concat(m,"/id/").concat(a)),password:a}}async function g(e){let t=await (0,n.QT)((0,n.JU)(r.db,"students",e));return t.exists()?t.data():null}async function h(e){let t=(0,n.hJ)(r.db,"students"),a=await (0,n.PL)(t),i=e.toLowerCase();return a.docs.map(e=>({...e.data(),id:e.data().id||e.id})).filter(e=>(e.firstName||"").toLowerCase().includes(i)||(e.lastName||"").toLowerCase().includes(i)||(e.id||"").toLowerCase().includes(i))}async function v(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1?arguments[1]:void 0,a=(0,n.hJ)(r.db,"students"),i=(0,n.IO)(a,(0,n.Xo)("createdAt","desc"),(0,n.b9)(e));t&&(i=(0,n.IO)(a,(0,n.Xo)("createdAt","desc"),(0,n.TQ)(t),(0,n.b9)(e)));let s=await (0,n.PL)(i);return{students:s.docs.map(e=>({...e.data(),id:e.data().id||e.id})),cursor:s.docs.length===e?s.docs[s.docs.length-1]:null}}async function w(e,t,a){await (0,n.r7)((0,n.JU)(r.db,"students",e),{["feeStatus.".concat(t)]:a})}async function N(e,t,a){if(isNaN(new Date(t).getTime()))throw Error("Invalid date");let i=t.slice(0,7),s=(0,n.JU)(r.db,"students",e,"attendance",i),l=await (0,n.QT)(s),o=l.exists()&&l.data().days||{};o[t]=a,await (0,n.pl)(s,{days:o},{merge:!0})}async function E(e,t,a){let i="".concat(t,"-").concat(String(a).padStart(2,"0")),s=(0,n.JU)(r.db,"students",e,"attendance",i),l=await (0,n.QT)(s);return l.exists()&&l.data().days||{}}async function x(e,t,a){await (0,n.pl)((0,n.JU)(r.db,"students",e,"results",t),{subjects:a,updatedAt:Date.now()})}async function A(e,t){let a=await (0,n.QT)((0,n.JU)(r.db,"students",e,"results",t));return a.exists()?a.data():null}},9506:function(e,t,a){"use strict";let r;a.d(t,{I:function(){return u},db:function(){return p}});var n=a(5236),i=a(5735),s=a(9842),l=a(9854),o=a(357);let d={apiKey:o.env.NEXT_PUBLIC_FIREBASE_API_KEY||"AIzaSyD239JqpspNL_KN7-buMq2PTWUM5P0D5YA",authDomain:o.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN||"milliniem-86b63.firebaseapp.com",projectId:o.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID||"milliniem-86b63",storageBucket:o.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET||"milliniem-86b63.appspot.com",messagingSenderId:o.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID||"455693438371",appId:o.env.NEXT_PUBLIC_FIREBASE_APP_ID||"1:455693438371:web:0a64c5c007cb906e241e16",measurementId:o.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID||"G-KHHJRMKW9V"},c=(0,n.C6)().length?(0,n.C6)()[0]:(0,n.ZF)(d),u=(0,i.v0)(c),m="true"===o.env.NEXT_PUBLIC_FIRESTORE_FORCE_LONG_POLLING,f="true"===o.env.NEXT_PUBLIC_FIRESTORE_AUTODETECT_STREAMING;try{m||f?(r=(0,s.LV)(c,{experimentalForceLongPolling:m,experimentalAutoDetectLongPolling:f}),console.log("[firebase] Firestore initialized with options",{forceLongPolling:m,autoDetect:f})):r=(0,s.ad)(c)}catch(e){console.error("[firebase] Firestore init error, falling back to default",e),r=(0,s.ad)(c)}let p=r;(0,l.cF)(c)}},function(e){e.O(0,[358,139,712,873,138,971,23,744],function(){return e(e.s=4105)}),_N_E=e.O()}]);