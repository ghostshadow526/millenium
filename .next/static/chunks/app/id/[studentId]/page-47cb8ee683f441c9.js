(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[836],{8563:function(e,t,a){Promise.resolve().then(a.bind(a,2695))},2695:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return o}});var n=a(7437),r=a(6463),i=a(2265),s=a(7374);function o(){let e=(0,r.useParams)(),t=null==e?void 0:e.studentId,[a,o]=(0,i.useState)(null),[d,l]=(0,i.useState)(!0);return((0,i.useEffect)(()=>{(async()=>{t&&(o(await (0,s.Wv)(t)),l(!1))})()},[t]),d)?(0,n.jsx)("div",{className:"py-24 text-center",children:"Loading..."}):a?(0,n.jsx)("div",{className:"min-h-[60vh] flex items-start justify-center py-16 px-6",children:(0,n.jsxs)("div",{className:"card w-full max-w-md text-center",children:[a.photoUrl&&(0,n.jsx)("img",{src:a.photoUrl,className:"w-40 h-40 rounded object-cover mx-auto mb-6"}),(0,n.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"STUDENT ID"}),(0,n.jsxs)("p",{className:"text-lg font-medium mb-1",children:[a.firstName," ",a.lastName]}),(0,n.jsxs)("p",{className:"text-white/60 text-sm mb-1",children:["Class: ",a.classLevel]}),(0,n.jsxs)("p",{className:"text-white/40 text-xs",children:["ID: ",a.id]})]})}):(0,n.jsx)("div",{className:"py-24 text-center",children:"Not found."})}},7374:function(e,t,a){"use strict";a.d(t,{BM:function(){return A},Gc:function(){return u},KD:function(){return d},O7:function(){return b},QN:function(){return N},Wv:function(){return E},YF:function(){return m},_8:function(){return l},_l:function(){return _},b0:function(){return c},iM:function(){return v},l6:function(){return h},tS:function(){return p},y7:function(){return w}});var n=a(9506),r=a(9842),i=a(2107),s=a(9783),o=a(357);async function d(e){try{var t,a;let i=await (0,r.QT)((0,r.JU)(n.db,"students",e));if(!i.exists())return null;let s=i.data(),o=s.name||[s.firstName,s.lastName].filter(Boolean).join(" ").trim();return{id:i.id,name:o,firstName:s.firstName,lastName:s.lastName,class:s.class||s.classLevel||"",classLevel:s.classLevel,email:s.email,age:s.age||0,rollNumber:s.rollNumber||s.id||"",parentPhone:s.parentPhone,parentEmail:s.parentEmail,photoUrl:s.photoUrl,qrCode:s.qrCode,registeredBy:s.registeredBy||"admin",registeredByUid:s.registeredByUid||s.createdBy||"",feeStatus:s.feeStatus||{term1:!1,term2:!1,term3:!1},createdAt:(null===(t=s.createdAt)||void 0===t?void 0:t.toDate)?s.createdAt.toDate():s.createdAt?new Date(s.createdAt):new Date,updatedAt:(null===(a=s.updatedAt)||void 0===a?void 0:a.toDate)?s.updatedAt.toDate():s.updatedAt?new Date(s.updatedAt):new Date}}catch(e){return console.error("Error fetching student:",e),null}}async function l(e){try{let t=(0,r.IO)((0,r.hJ)(n.db,"students"),(0,r.ar)("class","==",e),(0,r.Xo)("name"));return(await (0,r.PL)(t)).docs.map(e=>{var t,a;return{...e.data(),id:e.id,createdAt:(null===(t=e.data().createdAt)||void 0===t?void 0:t.toDate())||new Date,updatedAt:(null===(a=e.data().updatedAt)||void 0===a?void 0:a.toDate())||new Date}})}catch(e){return console.error("Error fetching students by class:",e),[]}}async function c(e){try{let t=(await (0,r.PL)((0,r.hJ)(n.db,"students"))).docs.map(e=>{var t,a;let n=e.data(),r=n.name||[n.firstName,n.lastName].filter(Boolean).join(" ").trim();return{id:e.id,name:r,firstName:n.firstName,lastName:n.lastName,class:n.class||n.classLevel||"",classLevel:n.classLevel,email:n.email,age:n.age||0,rollNumber:n.rollNumber||e.id,parentPhone:n.parentPhone,parentEmail:n.parentEmail,photoUrl:n.photoUrl,qrCode:n.qrCode,registeredBy:n.registeredBy||"admin",registeredByUid:n.registeredByUid||n.createdBy||"",feeStatus:n.feeStatus||{term1:!1,term2:!1,term3:!1},createdAt:(null===(t=n.createdAt)||void 0===t?void 0:t.toDate)?n.createdAt.toDate():n.createdAt?new Date(n.createdAt):new Date,updatedAt:(null===(a=n.updatedAt)||void 0===a?void 0:a.toDate)?n.updatedAt.toDate():n.updatedAt?new Date(n.updatedAt):new Date}}),a=e.toLowerCase();return t.filter(e=>e.name.toLowerCase().includes(a)||e.rollNumber.toLowerCase().includes(a))}catch(e){return console.error("Error searching students:",e),[]}}async function u(e,t){try{let a={...t,updatedAt:new Date};if(t.name&&!t.firstName&&!t.lastName){let e=t.name.split(" ");e.length>1&&(a.firstName=e.slice(0,-1).join(" "),a.lastName=e.slice(-1).join(" "))}await (0,r.r7)((0,r.JU)(n.db,"students",e),a)}catch(e){throw console.error("Error updating student:",e),e}}async function m(e,t,a,i){try{let s=(0,r.JU)((0,r.hJ)(n.db,"attendance")),o={id:s.id,studentId:e,date:t,status:a,markedBy:i,markedAt:new Date};await (0,r.pl)(s,o)}catch(e){throw console.error("Error marking attendance:",e),e}}async function f(e){let t=new Date().getFullYear();return"".concat(e.replace(/\s+/g,"").toUpperCase(),"-").concat(t,"-").concat(Math.floor(1e3+9e3*Math.random()))}async function p(e){let t;let a=await f(e.classLevel);if(e.photoFile){var d;let n=e.photoFile;if(!["image/jpeg","image/jpg","image/png"].includes(n.type))throw Error("VALIDATION_UNSUPPORTED_TYPE");if(n.size>5242880)throw Error("VALIDATION_FILE_TOO_LARGE");let r=await (0,i.Z)(n,{maxSizeMB:.25,maxWidthOrHeight:600}),s=r instanceof Blob?r:new Blob([r]),l=new FormData;l.append("image",s,"".concat(a,".jpg"));let c=o.env.NEXT_PUBLIC_IMGBB_KEY||"eb795bdf868353332baf6495a1a83fa0",u=await fetch("https://api.imgbb.com/1/upload?key=".concat(c),{method:"POST",body:l}),m=await u.json();if(!u.ok||!(null==m?void 0:m.success))throw Error("IMGBB_UPLOAD_FAILED");if(!(t=null===(d=m.data)||void 0===d?void 0:d.url))throw Error("IMGBB_NO_URL_RETURNED")}let{photoFile:l,...c}=e,u={...c,id:a,photoUrl:t,feeStatus:{term1:!1,term2:!1,term3:!1},createdAt:Date.now()};await (0,r.pl)((0,r.JU)(n.db,"students",a),u);let m=window.location.origin;return{student:u,qrDataUrl:await s.toDataURL("".concat(m,"/id/").concat(a)),password:a}}async function E(e){let t=await (0,r.QT)((0,r.JU)(n.db,"students",e));return t.exists()?t.data():null}async function h(e){let t=(0,r.hJ)(n.db,"students"),a=await (0,r.PL)(t),i=e.toLowerCase();return a.docs.map(e=>({...e.data(),id:e.data().id||e.id})).filter(e=>(e.firstName||"").toLowerCase().includes(i)||(e.lastName||"").toLowerCase().includes(i)||(e.id||"").toLowerCase().includes(i))}async function N(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1?arguments[1]:void 0,a=(0,r.hJ)(n.db,"students"),i=(0,r.IO)(a,(0,r.Xo)("createdAt","desc"),(0,r.b9)(e));t&&(i=(0,r.IO)(a,(0,r.Xo)("createdAt","desc"),(0,r.TQ)(t),(0,r.b9)(e)));let s=await (0,r.PL)(i);return{students:s.docs.map(e=>({...e.data(),id:e.data().id||e.id})),cursor:s.docs.length===e?s.docs[s.docs.length-1]:null}}async function w(e,t,a){await (0,r.r7)((0,r.JU)(n.db,"students",e),{["feeStatus.".concat(t)]:a})}async function _(e,t,a){if(isNaN(new Date(t).getTime()))throw Error("Invalid date");let i=t.slice(0,7),s=(0,r.JU)(n.db,"students",e,"attendance",i),o=await (0,r.QT)(s),d=o.exists()&&o.data().days||{};d[t]=a,await (0,r.pl)(s,{days:d},{merge:!0})}async function A(e,t,a){let i="".concat(t,"-").concat(String(a).padStart(2,"0")),s=(0,r.JU)(n.db,"students",e,"attendance",i),o=await (0,r.QT)(s);return o.exists()&&o.data().days||{}}async function v(e,t,a){await (0,r.pl)((0,r.JU)(n.db,"students",e,"results",t),{subjects:a,updatedAt:Date.now()})}async function b(e,t){let a=await (0,r.QT)((0,r.JU)(n.db,"students",e,"results",t));return a.exists()?a.data():null}},9506:function(e,t,a){"use strict";let n;a.d(t,{I:function(){return u},db:function(){return p}});var r=a(5236),i=a(5735),s=a(9842),o=a(9854),d=a(357);let l={apiKey:d.env.NEXT_PUBLIC_FIREBASE_API_KEY||"AIzaSyD239JqpspNL_KN7-buMq2PTWUM5P0D5YA",authDomain:d.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN||"milliniem-86b63.firebaseapp.com",projectId:d.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID||"milliniem-86b63",storageBucket:d.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET||"milliniem-86b63.appspot.com",messagingSenderId:d.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID||"455693438371",appId:d.env.NEXT_PUBLIC_FIREBASE_APP_ID||"1:455693438371:web:0a64c5c007cb906e241e16",measurementId:d.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID||"G-KHHJRMKW9V"},c=(0,r.C6)().length?(0,r.C6)()[0]:(0,r.ZF)(l),u=(0,i.v0)(c),m="true"===d.env.NEXT_PUBLIC_FIRESTORE_FORCE_LONG_POLLING,f="true"===d.env.NEXT_PUBLIC_FIRESTORE_AUTODETECT_STREAMING;try{m||f?(n=(0,s.LV)(c,{experimentalForceLongPolling:m,experimentalAutoDetectLongPolling:f}),console.log("[firebase] Firestore initialized with options",{forceLongPolling:m,autoDetect:f})):n=(0,s.ad)(c)}catch(e){console.error("[firebase] Firestore init error, falling back to default",e),n=(0,s.ad)(c)}let p=n;(0,o.cF)(c)}},function(e){e.O(0,[358,139,712,873,971,23,744],function(){return e(e.s=8563)}),_N_E=e.O()}]);