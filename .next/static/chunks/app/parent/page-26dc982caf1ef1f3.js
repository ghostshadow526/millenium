(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[771],{1357:function(e,t,a){Promise.resolve().then(a.bind(a,9345))},9345:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return f}});var n=a(7437),r=a(4819),s=a(9630),l=a(9842),i=a(9506),d=a(2265),o=a(7374),c=a(2469),u=a(4192),m=a(3673),h=a(3265);function f(){return(0,n.jsx)(r.Z,{allowed:["parent","admin"],children:(0,n.jsx)(p,{})})}function p(){var e;let{roleInfo:t}=(0,s.a)(),[a,r]=(0,d.useState)(null==t?void 0:t.studentId),[f,p]=(0,d.useState)(null),[x,g]=(0,d.useState)(new Date),[v,N]=(0,d.useState)({}),[b,w]=(0,d.useState)("term1"),[j,y]=(0,d.useState)(null),[E,I]=(0,d.useState)(""),[A,_]=(0,d.useState)([]),[D,S]=(0,d.useState)(!1),[L,U]=(0,d.useState)(null);async function B(e){try{S(!0),U(null);let t=e&&e.trim().length>0?"https://gutendex.com/books/?search=".concat(encodeURIComponent(e.trim())):"https://gutendex.com/books/?page=1",a=await fetch(t);if(!a.ok)throw Error("Failed to load books");let n=await a.json();_((n.results||[]).slice(0,4))}catch(e){U(e.message||"Error fetching books")}finally{S(!1)}}function T(){B(E)}return((0,d.useEffect)(()=>{(async()=>{if(null==t?void 0:t.studentId){r(t.studentId);return}if((null==t?void 0:t.role)==="parent"){var e;let t=(null===(e=(0,s.a)().user)||void 0===e?void 0:e.email)||null;if(t)try{let e=await (0,l.PL)((0,l.IO)((0,l.hJ)(i.db,"students"),(0,l.ar)("parentEmail","==",t),(0,l.b9)(1)));e.empty||r(e.docs[0].id)}catch(e){}}})()},[t]),(0,d.useEffect)(()=>{(async()=>{a&&p(await (0,o.KD)(a))})()},[a]),(0,d.useEffect)(()=>{(async()=>{if(!a)return;let e=x.getFullYear(),t=x.getMonth()+1;N(await (0,o.BM)(a,e,t))})()},[a,x]),(0,d.useEffect)(()=>{(async()=>{a&&y(await (0,o.O7)(a,b))})()},[a,b]),(0,d.useEffect)(()=>{B()},[]),a)?f?!f||f.name||f.firstName?(0,n.jsxs)("div",{className:"max-w-5xl mx-auto px-6 py-12 space-y-8",children:[(0,n.jsxs)("div",{className:"card flex gap-6 items-center",children:[f.photoUrl&&(0,n.jsx)("img",{src:f.photoUrl,className:"w-24 h-24 object-cover rounded"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-xl font-semibold",children:f.name||[f.firstName,f.lastName].filter(Boolean).join(" ")}),(0,n.jsxs)("p",{className:"text-white/60 text-sm",children:["Class: ",f.class||f.classLevel||"â€”"]}),(0,n.jsxs)("p",{className:"text-white/40 text-xs",children:["ID: ",a]})]})]}),(0,n.jsxs)("div",{className:"grid md:grid-cols-3 gap-6",children:[(0,n.jsxs)("div",{className:"card md:col-span-2",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,n.jsx)("button",{className:"btn outline",onClick:()=>g(e=>new Date(e.getFullYear(),e.getMonth()-1,1)),children:"<"}),(0,n.jsx)("strong",{children:(0,h.WU)(x,"MMMM yyyy")}),(0,n.jsx)("button",{className:"btn outline",onClick:()=>g(e=>new Date(e.getFullYear(),e.getMonth()+1,1)),children:">"})]}),(0,n.jsx)("div",{className:"grid grid-cols-7 gap-2 mt-2",children:(function(){let e=(0,c.N)(x),t=(0,u.V)(x);return(0,m.D)({start:e,end:t})})().map(e=>{let t=(0,h.WU)(e,"yyyy-MM-dd"),a=v[t];return(0,n.jsx)("div",{className:"h-12 rounded border text-center leading-[3rem] text-sm ".concat(a?"bg-green-500 text-black border-green-500":"border-white/10 text-white/60"),children:(0,h.WU)(e,"dd")},t)})})]}),(0,n.jsxs)("div",{className:"card",children:[(0,n.jsx)("h3",{className:"font-medium mb-2",children:"Fees"}),["term1","term2","term3"].map(e=>{var t;return(0,n.jsxs)("p",{className:"text-sm",children:[e.replace("term","Term "),": ",(null===(t=f.feeStatus)||void 0===t?void 0:t[e])?(0,n.jsx)("span",{className:"text-green-400",children:"Paid"}):(0,n.jsx)("span",{className:"text-red-400",children:"Unpaid"})]},e)})]})]}),(0,n.jsxs)("div",{className:"card",children:[(0,n.jsx)("h3",{className:"font-medium mb-2",children:"Results"}),(0,n.jsxs)("select",{value:b,onChange:e=>w(e.target.value),className:"mb-3",children:[(0,n.jsx)("option",{value:"term1",children:"Term 1"}),(0,n.jsx)("option",{value:"term2",children:"Term 2"}),(0,n.jsx)("option",{value:"term3",children:"Term 3"})]}),(0,n.jsx)("div",{className:"overflow-auto",children:(0,n.jsxs)("table",{className:"table",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"Subject"}),(0,n.jsx)("th",{children:"Grade"})]})}),(0,n.jsx)("tbody",{children:(null==j?void 0:null===(e=j.subjects)||void 0===e?void 0:e.length)?j.subjects.map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:e.name}),(0,n.jsx)("td",{children:e.grade})]},e.name)):(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:2,children:"No results yet."})})})]})})]}),(0,n.jsxs)("div",{className:"card",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,n.jsx)("h3",{className:"font-medium",children:"Digital Library"}),(0,n.jsx)("a",{href:"/parent/library",className:"btn primary",children:"Open Library"})]}),(0,n.jsx)("p",{className:"text-xs text-white/60 mb-3",children:"Boost your child's learning. Search and read free classic books."}),(0,n.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,n.jsx)("input",{value:E,onChange:e=>I(e.target.value),onKeyDown:e=>{"Enter"===e.key&&T()},placeholder:"Search books (e.g. science, math, history)",className:"flex-1 bg-white/5 border border-white/10 rounded px-3 py-2 text-sm focus:outline-none"}),(0,n.jsx)("button",{onClick:T,className:"btn outline",children:"Search"})]}),L&&(0,n.jsx)("p",{className:"text-red-400 text-sm mb-2",children:L}),D&&(0,n.jsx)("p",{className:"text-sm text-white/60",children:"Loading books..."}),!D&&!L&&(0,n.jsxs)("div",{className:"grid sm:grid-cols-2 md:grid-cols-4 gap-3",children:[A.map(e=>{var t;let a=null===(t=e.formats)||void 0===t?void 0:t["image/jpeg"];return(0,n.jsxs)("div",{className:"bg-white/5 rounded p-2 flex flex-col gap-2",children:[a&&(0,n.jsx)("img",{src:a,alt:e.title,className:"h-32 w-full object-cover rounded"}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("p",{className:"text-xs font-medium line-clamp-2 leading-snug",children:e.title}),(0,n.jsx)("p",{className:"text-[10px] text-white/50 line-clamp-1",children:(e.authors||[]).map(e=>e.name).join(", ")||"Unknown"})]}),(0,n.jsx)("a",{href:"/parent/library?open=".concat(e.id),className:"text-[10px] underline text-blue-300",children:"Read"})]},e.id)}),0===A.length&&(0,n.jsx)("p",{className:"text-sm col-span-full text-white/60",children:"No books found."})]})]})]}):(0,n.jsxs)("div",{className:"max-w-md mx-auto text-center py-20 space-y-4",children:[(0,n.jsx)("p",{className:"text-lg font-medium",children:"Student record not found."}),(0,n.jsx)("p",{className:"text-sm text-white/60",children:"Please contact the school to verify the linked student ID."})]}):(0,n.jsx)("p",{className:"text-center py-20",children:"Loading..."}):(0,n.jsx)("p",{className:"text-center py-20",children:"No student linked."})}},4819:function(e,t,a){"use strict";a.d(t,{Z:function(){return i}});var n=a(7437),r=a(2265),s=a(6463),l=a(9630);function i(e){let{allowed:t,children:a}=e,{loading:i,roleInfo:d,isOverrideAdmin:o}=(0,l.a)(),c=(0,s.useRouter)(),u=(null==d?void 0:d.role)||(o?"admin":null);return((0,r.useEffect)(()=>{i||u&&t.includes(u)||c.replace("/login")},[i,u,t,c]),i)?(0,n.jsx)("p",{className:"text-center py-10 text-white/80",children:"Loading..."}):u&&t.includes(u)?(0,n.jsx)(n.Fragment,{children:a}):null}},9630:function(e,t,a){"use strict";a.d(t,{AuthProvider:function(){return o},a:function(){return c}});var n=a(7437),r=a(2265),s=a(5735),l=a(9842),i=a(9506);let d=(0,r.createContext)({user:null,loading:!0,roleInfo:null,logout:async()=>{},isOverrideAdmin:!1,enableAdminOverride:()=>{}}),o=e=>{let{children:t}=e,[a,o]=(0,r.useState)(null),[c,u]=(0,r.useState)(!0),[m,h]=(0,r.useState)(null),[f,p]=(0,r.useState)(!!localStorage.getItem("overrideAdmin"));async function x(){localStorage.removeItem("overrideAdmin"),i.I.currentUser&&await (0,s.w7)(i.I)}return(0,r.useEffect)(()=>{let e=(0,s.Aj)(i.I,async e=>{o(e);let t=localStorage.getItem("pendingRole");if(e){let a=(0,l.JU)(i.db,"users",e.uid),n=await (0,l.QT)(a);if(n.exists()){let e=n.data();h({role:e.role,studentId:e.studentId,classLevels:e.classLevels})}else t?h({role:t}):h(null)}else h(null);u(!1),t&&localStorage.removeItem("pendingRole")});return()=>e()},[]),(0,n.jsx)(d.Provider,{value:{user:a,loading:c,roleInfo:m||(f?{role:"admin"}:null),logout:x,isOverrideAdmin:f,enableAdminOverride:function(){localStorage.setItem("overrideAdmin","true"),p(!0),h({role:"admin"})}},children:t})},c=()=>(0,r.useContext)(d)},7374:function(e,t,a){"use strict";a.d(t,{BM:function(){return b},Gc:function(){return u},KD:function(){return d},O7:function(){return j},QN:function(){return g},Wv:function(){return p},YF:function(){return m},_8:function(){return o},_l:function(){return N},b0:function(){return c},iM:function(){return w},l6:function(){return x},tS:function(){return f},y7:function(){return v}});var n=a(9506),r=a(9842),s=a(2107),l=a(9783),i=a(357);async function d(e){try{var t,a;let s=await (0,r.QT)((0,r.JU)(n.db,"students",e));if(!s.exists())return null;let l=s.data(),i=l.name||[l.firstName,l.lastName].filter(Boolean).join(" ").trim();return{id:s.id,name:i,firstName:l.firstName,lastName:l.lastName,class:l.class||l.classLevel||"",classLevel:l.classLevel,email:l.email,age:l.age||0,rollNumber:l.rollNumber||l.id||"",parentPhone:l.parentPhone,parentEmail:l.parentEmail,photoUrl:l.photoUrl,qrCode:l.qrCode,registeredBy:l.registeredBy||"admin",registeredByUid:l.registeredByUid||l.createdBy||"",feeStatus:l.feeStatus||{term1:!1,term2:!1,term3:!1},createdAt:(null===(t=l.createdAt)||void 0===t?void 0:t.toDate)?l.createdAt.toDate():l.createdAt?new Date(l.createdAt):new Date,updatedAt:(null===(a=l.updatedAt)||void 0===a?void 0:a.toDate)?l.updatedAt.toDate():l.updatedAt?new Date(l.updatedAt):new Date}}catch(e){return console.error("Error fetching student:",e),null}}async function o(e){try{let t=(0,r.IO)((0,r.hJ)(n.db,"students"),(0,r.ar)("class","==",e),(0,r.Xo)("name"));return(await (0,r.PL)(t)).docs.map(e=>{var t,a;return{...e.data(),id:e.id,createdAt:(null===(t=e.data().createdAt)||void 0===t?void 0:t.toDate())||new Date,updatedAt:(null===(a=e.data().updatedAt)||void 0===a?void 0:a.toDate())||new Date}})}catch(e){return console.error("Error fetching students by class:",e),[]}}async function c(e){try{let t=(await (0,r.PL)((0,r.hJ)(n.db,"students"))).docs.map(e=>{var t,a;let n=e.data(),r=n.name||[n.firstName,n.lastName].filter(Boolean).join(" ").trim();return{id:e.id,name:r,firstName:n.firstName,lastName:n.lastName,class:n.class||n.classLevel||"",classLevel:n.classLevel,email:n.email,age:n.age||0,rollNumber:n.rollNumber||e.id,parentPhone:n.parentPhone,parentEmail:n.parentEmail,photoUrl:n.photoUrl,qrCode:n.qrCode,registeredBy:n.registeredBy||"admin",registeredByUid:n.registeredByUid||n.createdBy||"",feeStatus:n.feeStatus||{term1:!1,term2:!1,term3:!1},createdAt:(null===(t=n.createdAt)||void 0===t?void 0:t.toDate)?n.createdAt.toDate():n.createdAt?new Date(n.createdAt):new Date,updatedAt:(null===(a=n.updatedAt)||void 0===a?void 0:a.toDate)?n.updatedAt.toDate():n.updatedAt?new Date(n.updatedAt):new Date}}),a=e.toLowerCase();return t.filter(e=>e.name.toLowerCase().includes(a)||e.rollNumber.toLowerCase().includes(a))}catch(e){return console.error("Error searching students:",e),[]}}async function u(e,t){try{let a={...t,updatedAt:new Date};if(t.name&&!t.firstName&&!t.lastName){let e=t.name.split(" ");e.length>1&&(a.firstName=e.slice(0,-1).join(" "),a.lastName=e.slice(-1).join(" "))}await (0,r.r7)((0,r.JU)(n.db,"students",e),a)}catch(e){throw console.error("Error updating student:",e),e}}async function m(e,t,a,s){try{let l=(0,r.JU)((0,r.hJ)(n.db,"attendance")),i={id:l.id,studentId:e,date:t,status:a,markedBy:s,markedAt:new Date};await (0,r.pl)(l,i)}catch(e){throw console.error("Error marking attendance:",e),e}}async function h(e){let t=new Date().getFullYear();return"".concat(e.replace(/\s+/g,"").toUpperCase(),"-").concat(t,"-").concat(Math.floor(1e3+9e3*Math.random()))}async function f(e){let t;let a=await h(e.classLevel);if(e.photoFile){var d;let n=e.photoFile;if(!["image/jpeg","image/jpg","image/png"].includes(n.type))throw Error("VALIDATION_UNSUPPORTED_TYPE");if(n.size>5242880)throw Error("VALIDATION_FILE_TOO_LARGE");let r=await (0,s.Z)(n,{maxSizeMB:.25,maxWidthOrHeight:600}),l=r instanceof Blob?r:new Blob([r]),o=new FormData;o.append("image",l,"".concat(a,".jpg"));let c=i.env.NEXT_PUBLIC_IMGBB_KEY||"eb795bdf868353332baf6495a1a83fa0",u=await fetch("https://api.imgbb.com/1/upload?key=".concat(c),{method:"POST",body:o}),m=await u.json();if(!u.ok||!(null==m?void 0:m.success))throw Error("IMGBB_UPLOAD_FAILED");if(!(t=null===(d=m.data)||void 0===d?void 0:d.url))throw Error("IMGBB_NO_URL_RETURNED")}let{photoFile:o,...c}=e,u={...c,id:a,photoUrl:t,feeStatus:{term1:!1,term2:!1,term3:!1},createdAt:Date.now()};await (0,r.pl)((0,r.JU)(n.db,"students",a),u);let m=window.location.origin;return{student:u,qrDataUrl:await l.toDataURL("".concat(m,"/id/").concat(a)),password:a}}async function p(e){let t=await (0,r.QT)((0,r.JU)(n.db,"students",e));return t.exists()?t.data():null}async function x(e){let t=(0,r.hJ)(n.db,"students"),a=await (0,r.PL)(t),s=e.toLowerCase();return a.docs.map(e=>({...e.data(),id:e.data().id||e.id})).filter(e=>(e.firstName||"").toLowerCase().includes(s)||(e.lastName||"").toLowerCase().includes(s)||(e.id||"").toLowerCase().includes(s))}async function g(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1?arguments[1]:void 0,a=(0,r.hJ)(n.db,"students"),s=(0,r.IO)(a,(0,r.Xo)("createdAt","desc"),(0,r.b9)(e));t&&(s=(0,r.IO)(a,(0,r.Xo)("createdAt","desc"),(0,r.TQ)(t),(0,r.b9)(e)));let l=await (0,r.PL)(s);return{students:l.docs.map(e=>({...e.data(),id:e.data().id||e.id})),cursor:l.docs.length===e?l.docs[l.docs.length-1]:null}}async function v(e,t,a){await (0,r.r7)((0,r.JU)(n.db,"students",e),{["feeStatus.".concat(t)]:a})}async function N(e,t,a){if(isNaN(new Date(t).getTime()))throw Error("Invalid date");let s=t.slice(0,7),l=(0,r.JU)(n.db,"students",e,"attendance",s),i=await (0,r.QT)(l),d=i.exists()&&i.data().days||{};d[t]=a,await (0,r.pl)(l,{days:d},{merge:!0})}async function b(e,t,a){let s="".concat(t,"-").concat(String(a).padStart(2,"0")),l=(0,r.JU)(n.db,"students",e,"attendance",s),i=await (0,r.QT)(l);return i.exists()&&i.data().days||{}}async function w(e,t,a){await (0,r.pl)((0,r.JU)(n.db,"students",e,"results",t),{subjects:a,updatedAt:Date.now()})}async function j(e,t){let a=await (0,r.QT)((0,r.JU)(n.db,"students",e,"results",t));return a.exists()?a.data():null}},9506:function(e,t,a){"use strict";let n;a.d(t,{I:function(){return u},db:function(){return f}});var r=a(5236),s=a(5735),l=a(9842),i=a(9854),d=a(357);let o={apiKey:d.env.NEXT_PUBLIC_FIREBASE_API_KEY||"AIzaSyD239JqpspNL_KN7-buMq2PTWUM5P0D5YA",authDomain:d.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN||"milliniem-86b63.firebaseapp.com",projectId:d.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID||"milliniem-86b63",storageBucket:d.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET||"milliniem-86b63.appspot.com",messagingSenderId:d.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID||"455693438371",appId:d.env.NEXT_PUBLIC_FIREBASE_APP_ID||"1:455693438371:web:0a64c5c007cb906e241e16",measurementId:d.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID||"G-KHHJRMKW9V"},c=(0,r.C6)().length?(0,r.C6)()[0]:(0,r.ZF)(o),u=(0,s.v0)(c),m="true"===d.env.NEXT_PUBLIC_FIRESTORE_FORCE_LONG_POLLING,h="true"===d.env.NEXT_PUBLIC_FIRESTORE_AUTODETECT_STREAMING;try{m||h?(n=(0,l.LV)(c,{experimentalForceLongPolling:m,experimentalAutoDetectLongPolling:h}),console.log("[firebase] Firestore initialized with options",{forceLongPolling:m,autoDetect:h})):n=(0,l.ad)(c)}catch(e){console.error("[firebase] Firestore init error, falling back to default",e),n=(0,l.ad)(c)}let f=n;(0,i.cF)(c)}},function(e){e.O(0,[358,139,712,873,749,971,23,744],function(){return e(e.s=1357)}),_N_E=e.O()}]);