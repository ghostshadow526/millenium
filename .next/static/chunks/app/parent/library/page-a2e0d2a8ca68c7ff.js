(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[697],{5957:function(e,t,l){Promise.resolve().then(l.bind(l,4265))},6463:function(e,t,l){"use strict";var s=l(1169);l.o(s,"useParams")&&l.d(t,{useParams:function(){return s.useParams}}),l.o(s,"useRouter")&&l.d(t,{useRouter:function(){return s.useRouter}}),l.o(s,"useSearchParams")&&l.d(t,{useSearchParams:function(){return s.useSearchParams}})},4265:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return a}});var s=l(7437),r=l(4819),n=l(5737);function a(){return(0,s.jsx)(r.Z,{allowed:["parent","admin","teacher"],children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-6 py-10 space-y-8",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-semibold mb-1",children:"Digital Library"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Browse and read books your student can also access."})]}),(0,s.jsx)(n.Z,{})]})})}},5737:function(e,t,l){"use strict";l.d(t,{Z:function(){return a}});var s=l(7437),r=l(2265);let n=["Mathematics","English","Science","History"];function a(){var e,t;let[l,a]=(0,r.useState)(""),[i,o]=(0,r.useState)(!1),[c,d]=(0,r.useState)([]),[u,m]=(0,r.useState)(null),[x,f]=(0,r.useState)(null),[h,g]=(0,r.useState)(null),p=async e=>{o(!0),m(null);try{let t="https://gutendex.com/books/?search=".concat(encodeURIComponent(e)),l=await fetch(t);if(!l.ok)throw Error("Failed to fetch books");let s=await l.json();d(s.results||[])}catch(e){m(e.message||"Unknown error")}finally{o(!1)}},b=async e=>{o(!0),m(null);try{let t="https://gutendex.com/books/?search=".concat(encodeURIComponent(e)),l=await fetch(t);if(!l.ok)throw Error("Failed to fetch subject books");let s=await l.json();d(s.results||[]),f(e)}catch(e){m(e.message)}finally{o(!1)}},v=e=>{g(e)};return(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),l.trim()&&(f(null),p(l.trim()))},className:"flex w-full max-w-lg gap-2",children:[(0,s.jsx)("input",{value:l,onChange:e=>a(e.target.value),placeholder:"Search title, author, subject...",className:"flex-1 px-4 py-2 rounded border border-gray-300 text-sm"}),(0,s.jsx)("button",{className:"btn",type:"submit",disabled:!l.trim()||i,children:"Search"})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:[n.map(e=>(0,s.jsx)("button",{type:"button",onClick:()=>b(e),className:"px-3 py-1 rounded text-xs border ".concat(x===e?"bg-primary text-white border-primary":"border-gray-300 text-gray-600 hover:bg-gray-100"),children:e},e)),x&&(0,s.jsx)("button",{type:"button",onClick:()=>{f(null),d([])},className:"text-xs underline text-gray-500",children:"Clear"})]})]}),u&&(0,s.jsx)("div",{className:"text-sm text-red-600",children:u}),i&&(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"Loading books..."}),!i&&0===c.length&&!u&&(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"No books yet. Try searching or pick a subject."}),(0,s.jsx)("div",{className:"grid gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:c.map(e=>{var t,l;let r=e.formats["image/jpeg"],n=e.formats["text/html"],a=e.formats["application/epub+zip"],i=e.formats["application/pdf"],o=(null===(l=e.authors)||void 0===l?void 0:null===(t=l[0])||void 0===t?void 0:t.name)||"Unknown Author";return(0,s.jsxs)("div",{className:"rounded-lg border border-gray-200 bg-white flex flex-col overflow-hidden shadow-sm",children:[r?(0,s.jsx)("img",{src:r,alt:e.title,className:"h-40 w-full object-cover"}):(0,s.jsx)("div",{className:"h-40 w-full bg-gray-100 flex items-center justify-center text-gray-400 text-xs",children:"No Cover"}),(0,s.jsxs)("div",{className:"flex flex-col flex-1 p-4 gap-2",children:[(0,s.jsx)("h3",{className:"font-semibold text-sm line-clamp-2 leading-snug",children:e.title}),(0,s.jsx)("p",{className:"text-xs text-gray-500 line-clamp-1",children:o}),(0,s.jsxs)("div",{className:"mt-auto flex flex-wrap gap-2 pt-2",children:[n&&(0,s.jsx)("button",{type:"button",onClick:()=>v(e),className:"btn outline text-xs",children:"Read Online"}),(a||i)&&(0,s.jsx)("a",{href:a||i,target:"_blank",rel:"noopener noreferrer",className:"btn outline text-xs",children:"Download"})]})]})]},e.id)})}),h&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"bg-white w-full max-w-5xl rounded-lg shadow-lg flex flex-col max-h-[90vh]",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 border-b",children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"font-semibold text-sm",children:h.title}),(0,s.jsx)("span",{className:"text-xs text-gray-500",children:(null===(t=h.authors)||void 0===t?void 0:null===(e=t[0])||void 0===e?void 0:e.name)||"Unknown Author"})]}),(0,s.jsx)("button",{onClick:()=>g(null),className:"text-xs px-2 py-1 rounded bg-gray-100 hover:bg-gray-200",children:"Close"})]}),(0,s.jsx)("div",{className:"flex-1 overflow-auto",children:h.formats["text/html"]?(0,s.jsx)("iframe",{src:h.formats["text/html"],title:h.title,className:"w-full h-[70vh]"}):(0,s.jsx)("div",{className:"p-6 text-sm",children:"No embeddable HTML version available for this title."})})]})})]})}},4819:function(e,t,l){"use strict";l.d(t,{Z:function(){return i}});var s=l(7437),r=l(2265),n=l(6463),a=l(9630);function i(e){let{allowed:t,children:l}=e,{loading:i,roleInfo:o,isOverrideAdmin:c}=(0,a.a)(),d=(0,n.useRouter)(),u=(null==o?void 0:o.role)||(c?"admin":null);return((0,r.useEffect)(()=>{i||u&&t.includes(u)||d.replace("/login")},[i,u,t,d]),i)?(0,s.jsx)("p",{className:"text-center py-10 text-white/80",children:"Loading..."}):u&&t.includes(u)?(0,s.jsx)(s.Fragment,{children:l}):null}},9630:function(e,t,l){"use strict";l.d(t,{AuthProvider:function(){return c},a:function(){return d}});var s=l(7437),r=l(2265),n=l(5735),a=l(9842),i=l(9506);let o=(0,r.createContext)({user:null,loading:!0,roleInfo:null,logout:async()=>{},isOverrideAdmin:!1,enableAdminOverride:()=>{}}),c=e=>{let{children:t}=e,[l,c]=(0,r.useState)(null),[d,u]=(0,r.useState)(!0),[m,x]=(0,r.useState)(null),[f,h]=(0,r.useState)(!!localStorage.getItem("overrideAdmin"));async function g(){localStorage.removeItem("overrideAdmin"),i.I.currentUser&&await (0,n.w7)(i.I)}return(0,r.useEffect)(()=>{let e=(0,n.Aj)(i.I,async e=>{c(e);let t=localStorage.getItem("pendingRole");if(e){let l=(0,a.JU)(i.db,"users",e.uid),s=await (0,a.QT)(l);if(s.exists()){let e=s.data();x({role:e.role,studentId:e.studentId,classLevels:e.classLevels})}else t?x({role:t}):x(null)}else x(null);u(!1),t&&localStorage.removeItem("pendingRole")});return()=>e()},[]),(0,s.jsx)(o.Provider,{value:{user:l,loading:d,roleInfo:m||(f?{role:"admin"}:null),logout:g,isOverrideAdmin:f,enableAdminOverride:function(){localStorage.setItem("overrideAdmin","true"),h(!0),x({role:"admin"})}},children:t})},d=()=>(0,r.useContext)(o)},9506:function(e,t,l){"use strict";let s;l.d(t,{I:function(){return u},db:function(){return f}});var r=l(5236),n=l(5735),a=l(9842),i=l(9854),o=l(357);let c={apiKey:o.env.NEXT_PUBLIC_FIREBASE_API_KEY||"AIzaSyD239JqpspNL_KN7-buMq2PTWUM5P0D5YA",authDomain:o.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN||"milliniem-86b63.firebaseapp.com",projectId:o.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID||"milliniem-86b63",storageBucket:o.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET||"milliniem-86b63.appspot.com",messagingSenderId:o.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID||"455693438371",appId:o.env.NEXT_PUBLIC_FIREBASE_APP_ID||"1:455693438371:web:0a64c5c007cb906e241e16",measurementId:o.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID||"G-KHHJRMKW9V"},d=(0,r.C6)().length?(0,r.C6)()[0]:(0,r.ZF)(c),u=(0,n.v0)(d),m="true"===o.env.NEXT_PUBLIC_FIRESTORE_FORCE_LONG_POLLING,x="true"===o.env.NEXT_PUBLIC_FIRESTORE_AUTODETECT_STREAMING;try{m||x?(s=(0,a.LV)(d,{experimentalForceLongPolling:m,experimentalAutoDetectLongPolling:x}),console.log("[firebase] Firestore initialized with options",{forceLongPolling:m,autoDetect:x})):s=(0,a.ad)(d)}catch(e){console.error("[firebase] Firestore init error, falling back to default",e),s=(0,a.ad)(d)}let f=s;(0,i.cF)(d)}},function(e){e.O(0,[358,139,712,971,23,744],function(){return e(e.s=5957)}),_N_E=e.O()}]);