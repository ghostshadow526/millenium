(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{890:function(e,t,a){Promise.resolve().then(a.bind(a,1193))},1193:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return u}});var s=a(7437),l=a(2265),r=a(5735),n=a(9506),i=a(9842),d=a(6463),c=a(9630),o=a(1359);function m(){let e=(0,d.useSearchParams)(),t=(null==e?void 0:e.get("role"))||"parent",[a,m]=(0,l.useState)(t),[u,x]=(0,l.useState)(""),[g,p]=(0,l.useState)(""),[h,b]=(0,l.useState)(!1),[f,v]=(0,l.useState)(null),N=(0,d.useRouter)(),{enableAdminOverride:I}=(0,c.a)();(0,l.useEffect)(()=>{let t=null==e?void 0:e.get("role");t&&["parent","teacher","admin"].includes(t)&&m(t)},[e]);let _=async e=>{e.preventDefault(),v(null),b(!0);try{if("admin"===a&&"abbasabdulkadir526@gmail.com"===u.trim()&&"eatmyass"===g){I(),localStorage.setItem("pendingRole","admin"),N.push("/admin");return}let e=await (0,r.e5)(n.I,u.trim(),g),t=(0,i.JU)(n.db,"users",e.user.uid),s=await (0,i.QT)(t),l=s.exists()?s.data().studentId:void 0;if("parent"===a&&!l){let e=await (0,i.PL)((0,i.IO)((0,i.hJ)(n.db,"students"),(0,i.ar)("parentEmail","==",u.trim()),(0,i.b9)(1)));e.empty||(l=e.docs[0].id)}let d={role:a};l&&(d.studentId=l),await (0,i.pl)(t,d,{merge:!0}),localStorage.setItem("pendingRole",a),"teacher"===a?N.push("/teacher"):"admin"===a?N.push("/admin"):"parent"===a&&N.push("/parent")}catch(e){v(e.message||"Login failed")}finally{b(!1)}};return(0,s.jsx)("section",{className:"bg-slateGray min-h-screen flex items-center justify-center",children:(0,s.jsx)("div",{className:"portal-container",children:(0,s.jsx)("div",{className:"max-w-md mx-auto",children:(0,s.jsxs)("div",{className:"card",children:[(0,s.jsxs)("div",{className:"text-center mb-8",children:[(0,s.jsx)("div",{className:"mx-auto w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mb-4",children:(0,s.jsx)(o.JO,{icon:"solar:login-3-bold",className:"text-2xl text-primary"})}),(0,s.jsx)("h2",{className:"text-2xl font-semibold text-midnight_text",children:"Portal Login"}),(0,s.jsx)("p",{className:"text-grey mt-2",children:"Access your dashboard"})]}),(0,s.jsxs)("form",{onSubmit:_,className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-midnight_text mb-3",children:"Select Role"}),(0,s.jsx)("div",{className:"grid grid-cols-3 gap-2",children:["parent","teacher","admin"].map(e=>(0,s.jsx)("button",{type:"button",onClick:()=>m(e),className:"px-4 py-3 rounded-lg text-sm font-medium border transition ".concat(a===e?"bg-primary text-white border-primary":"border-gray-300 text-midnight_text hover:bg-gray-50"),children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-midnight_text mb-2",children:"Email Address"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"email",value:u,onChange:e=>x(e.target.value),required:!0,placeholder:"user@example.com",className:"w-full pl-12"}),(0,s.jsx)(o.JO,{icon:"solar:letter-bold",className:"absolute left-4 top-1/2 -translate-y-1/2 text-grey text-lg"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-midnight_text mb-2",children:"Password"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"password",value:g,onChange:e=>p(e.target.value),required:!0,placeholder:"••••••••",className:"w-full pl-12"}),(0,s.jsx)(o.JO,{icon:"solar:lock-password-bold",className:"absolute left-4 top-1/2 -translate-y-1/2 text-grey text-lg"})]})]}),(0,s.jsx)("button",{className:"btn w-full justify-center",type:"submit",disabled:h,children:h?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.JO,{icon:"solar:loading-bold",className:"text-lg animate-spin"}),"Authenticating..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.JO,{icon:"solar:login-2-bold",className:"text-lg"}),"Sign In"]})}),f&&(0,s.jsxs)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-sm text-red-700 flex items-center gap-2",children:[(0,s.jsx)(o.JO,{icon:"solar:danger-circle-bold",className:"text-lg text-red-500"}),f]})]}),(0,s.jsx)("div",{className:"mt-6 pt-6 border-t border-gray-200 text-center",children:(0,s.jsx)("p",{className:"text-xs text-grey",children:"Demo: Use admin override credentials for testing"})})]})})})})}function u(){return(0,s.jsx)(l.Suspense,{fallback:(0,s.jsx)("section",{className:"bg-slateGray min-h-screen flex items-center justify-center",children:(0,s.jsx)("div",{className:"portal-container",children:(0,s.jsx)("div",{className:"max-w-md mx-auto",children:(0,s.jsxs)("div",{className:"card text-center",children:[(0,s.jsx)(o.JO,{icon:"solar:loading-bold",className:"text-4xl text-primary animate-spin mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-grey",children:"Loading..."})]})})})}),children:(0,s.jsx)(m,{})})}},9630:function(e,t,a){"use strict";a.d(t,{AuthProvider:function(){return c},a:function(){return o}});var s=a(7437),l=a(2265),r=a(5735),n=a(9842),i=a(9506);let d=(0,l.createContext)({user:null,loading:!0,roleInfo:null,logout:async()=>{},isOverrideAdmin:!1,enableAdminOverride:()=>{}}),c=e=>{let{children:t}=e,[a,c]=(0,l.useState)(null),[o,m]=(0,l.useState)(!0),[u,x]=(0,l.useState)(null),[g,p]=(0,l.useState)(!!localStorage.getItem("overrideAdmin"));async function h(){localStorage.removeItem("overrideAdmin"),i.I.currentUser&&await (0,r.w7)(i.I)}return(0,l.useEffect)(()=>{let e=(0,r.Aj)(i.I,async e=>{c(e);let t=localStorage.getItem("pendingRole");if(e){let a=(0,n.JU)(i.db,"users",e.uid),s=await (0,n.QT)(a);if(s.exists()){let e=s.data();x({role:e.role,studentId:e.studentId,classLevels:e.classLevels})}else t?x({role:t}):x(null)}else x(null);m(!1),t&&localStorage.removeItem("pendingRole")});return()=>e()},[]),(0,s.jsx)(d.Provider,{value:{user:a,loading:o,roleInfo:u||(g?{role:"admin"}:null),logout:h,isOverrideAdmin:g,enableAdminOverride:function(){localStorage.setItem("overrideAdmin","true"),p(!0),x({role:"admin"})}},children:t})},o=()=>(0,l.useContext)(d)},9506:function(e,t,a){"use strict";let s;a.d(t,{I:function(){return m},db:function(){return g}});var l=a(5236),r=a(5735),n=a(9842),i=a(9854),d=a(357);let c={apiKey:d.env.NEXT_PUBLIC_FIREBASE_API_KEY||"AIzaSyD239JqpspNL_KN7-buMq2PTWUM5P0D5YA",authDomain:d.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN||"milliniem-86b63.firebaseapp.com",projectId:d.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID||"milliniem-86b63",storageBucket:d.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET||"milliniem-86b63.appspot.com",messagingSenderId:d.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID||"455693438371",appId:d.env.NEXT_PUBLIC_FIREBASE_APP_ID||"1:455693438371:web:0a64c5c007cb906e241e16",measurementId:d.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID||"G-KHHJRMKW9V"},o=(0,l.C6)().length?(0,l.C6)()[0]:(0,l.ZF)(c),m=(0,r.v0)(o),u="true"===d.env.NEXT_PUBLIC_FIRESTORE_FORCE_LONG_POLLING,x="true"===d.env.NEXT_PUBLIC_FIRESTORE_AUTODETECT_STREAMING;try{u||x?(s=(0,n.LV)(o,{experimentalForceLongPolling:u,experimentalAutoDetectLongPolling:x}),console.log("[firebase] Firestore initialized with options",{forceLongPolling:u,autoDetect:x})):s=(0,n.ad)(o)}catch(e){console.error("[firebase] Firestore init error, falling back to default",e),s=(0,n.ad)(o)}let g=s;(0,i.cF)(o)}},function(e){e.O(0,[358,139,712,549,971,23,744],function(){return e(e.s=890)}),_N_E=e.O()}]);